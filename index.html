<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>FME Service Dept Report</title>

    <!-- Mobile friendly -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- jsPDF core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- jsPDF AutoTable plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>

    <style>
      body {
        background: #f3f4f6;
      }
      .app-header {
        background: linear-gradient(135deg, #0d6efd, #0b5ed7);
        color: #fff;
        padding: 1.25rem 1rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      .app-title {
        margin: 0;
        font-size: 1.4rem;
        font-weight: 600;
      }
      .app-subtitle {
        margin: 0;
        font-size: 0.9rem;
        opacity: 0.9;
      }
      .app-card {
        border-radius: 1rem;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
        border: 0;
      }
      .app-card .card-body {
        padding: 1.25rem;
      }
      .section-title {
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #6c757d;
        margin-bottom: 0.5rem;
        margin-top: 1rem;
      }
      .table-sm td,
      .table-sm th {
        padding: 0.25rem 0.35rem;
        font-size: 0.8rem;
      }

      @media (max-width: 576px) {
        .app-header {
          border-radius: 0 0 1rem 1rem;
        }
        .app-card {
          border-radius: 1rem 1rem 0 0;
          margin-top: -1rem;
        }
        .generate-btn-sticky {
          position: sticky;
          bottom: 0;
          z-index: 20;
        }
      }
    </style>
  </head>
  <body>
    <!-- HEADER -->
    <header class="app-header">
      <div class="container">
        <p class="app-title mb-1">FME Service Dept Report</p>
        <p class="app-subtitle">
          Digital version of the Service Report – fill in and generate a PDF.
        </p>
      </div>
    </header>

    <main class="container my-3">
      <div class="card app-card">
        <div class="card-body">
          <form id="serviceForm" novalidate>
            <!-- 1. CUSTOMER / JOB INFO -->
            <div class="section-title">Customer &amp; Job Info</div>
            <div class="row g-2">
              <div class="col-md-6">
                <label class="form-label">Customer *</label>
                <input
                  type="text"
                  class="form-control"
                  name="customer"
                  required
                />
              </div>
              <div class="col-md-6">
                <label class="form-label">Contact</label>
                <input type="text" class="form-control" name="contact" />
              </div>
              <div class="col-md-8">
                <label class="form-label">Address</label>
                <input type="text" class="form-control" name="address" />
              </div>
              <div class="col-md-4">
                <label class="form-label">Task No.</label>
                <input type="text" class="form-control" name="taskNo" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Tel No.</label>
                <input type="text" class="form-control" name="telNo" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Date *</label>
                <input
                  type="date"
                  class="form-control"
                  id="reportDate"
                  name="reportDate"
                  required
                />
              </div>
            </div>

            <!-- 2. GENERAL DETAILS -->
            <div class="section-title">General Details</div>

            <!-- Sector -->
            <div class="mb-2">
              <label class="form-label d-block">Sector</label>
              <div class="row">
                <div class="col-6 col-md-2">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Industrial"
                      id="sectorIndustrial"
                    />
                    <label class="form-check-label" for="sectorIndustrial"
                      >Industrial</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-2">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Commercial"
                      id="sectorCommercial"
                    />
                    <label class="form-check-label" for="sectorCommercial"
                      >Commercial</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-2">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Domestic"
                      id="sectorDomestic"
                    />
                    <label class="form-check-label" for="sectorDomestic"
                      >Domestic</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-2">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Agricultural"
                      id="sectorAgricultural"
                    />
                    <label class="form-check-label" for="sectorAgricultural"
                      >Agricultural</label
                    >
                  </div>
                </div>
                <div class="col-12 col-md-4 mt-1 mt-md-0">
                  <div class="input-group input-group-sm">
                    <span class="input-group-text">Other</span>
                    <input type="text" class="form-control" id="sectorOther" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Description of works -->
            <div class="mb-2">
              <label class="form-label">Description of Works</label>
              <textarea
                class="form-control"
                name="descriptionOfWorks"
                rows="2"
              ></textarea>
            </div>

            <!-- High Risk Activities -->
            <div class="mb-2">
              <label class="form-label d-block">High Risk Activities</label>
              <div class="row g-1">
                <div class="col-6 col-md-3">
                  <div class="form-check form-check-sm">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Working at Height"
                      id="hrHeight"
                    />
                    <label class="form-check-label" for="hrHeight"
                      >Working at Height</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Confined Space"
                      id="hrConfined"
                    />
                    <label class="form-check-label" for="hrConfined"
                      >Confined Space</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Near Open Water"
                      id="hrWater"
                    />
                    <label class="form-check-label" for="hrWater"
                      >Near Open Water</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Electricity"
                      id="hrElectricity"
                    />
                    <label class="form-check-label" for="hrElectricity"
                      >Electricity</label
                    >
                  </div>
                </div>
                <div class="col-12 mt-1">
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="hrOther"
                    placeholder="Other (specify, optional)"
                  />
                </div>
              </div>
            </div>

            <!-- Specialist Equipment / PPE -->
            <div class="mb-2">
              <label class="form-label d-block"
                >Specialist Equipment / PPE Required</label
              >
              <div class="row g-1">
                <div class="col-6 col-md-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Ladder/Steps Ladder"
                      id="ppeLadder"
                    />
                    <label class="form-check-label" for="ppeLadder"
                      >Ladder/Steps Ladder</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Fixed/Mobile Scaffold"
                      id="ppeScaffold"
                    />
                    <label class="form-check-label" for="ppeScaffold"
                      >Fixed/Mobile Scaffold</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="MEWP"
                      id="ppeMewp"
                    />
                    <label class="form-check-label" for="ppeMewp">MEWP</label>
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Man Riding Winch"
                      id="ppeWinch"
                    />
                    <label class="form-check-label" for="ppeWinch"
                      >Man Riding Winch</label
                    >
                  </div>
                </div>

                <div class="col-6 col-md-3">
                  <div class="form-check mt-1">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Harness"
                      id="ppeHarness"
                    />
                    <label class="form-check-label" for="ppeHarness"
                      >Harness</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="form-check mt-1">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Gas Monitor"
                      id="ppeGasMonitor"
                    />
                    <label class="form-check-label" for="ppeGasMonitor"
                      >Gas Monitor</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="form-check mt-1">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Escape Set"
                      id="ppeEscapeSet"
                    />
                    <label class="form-check-label" for="ppeEscapeSet"
                      >Escape Set</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <input
                    type="text"
                    class="form-control form-control-sm mt-1"
                    id="ppeOther"
                    placeholder="Other (specify)"
                  />
                </div>
              </div>
            </div>

            <!-- Lifting Equipment Required -->
            <div class="mb-3">
              <label class="form-label d-block"
                >Lifting Equipment Required</label
              >
              <div class="row g-1">
                <div class="col-6 col-md-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Tripod & Winch"
                      id="liftTripod"
                    />
                    <label class="form-check-label" for="liftTripod"
                      >Tripod &amp; Winch</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Electric Hoist"
                      id="liftHoist"
                    />
                    <label class="form-check-label" for="liftHoist"
                      >Electric Hoist</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Fixed/Mobile Crane"
                      id="liftCrane"
                    />
                    <label class="form-check-label" for="liftCrane"
                      >Fixed/Mobile Crane</label
                    >
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="liftOther"
                    placeholder="Other (specify)"
                  />
                </div>
              </div>
            </div>

            <!-- 3. EQUIPMENT / PUMP DETAILS -->
            <div class="section-title">Equipment / Pump Details</div>
            <div class="table-responsive mb-3">
              <table class="table table-bordered table-sm align-middle">
                <thead class="table-light">
                  <tr>
                    <th></th>
                    <th class="text-center">Pump 1</th>
                    <th class="text-center">Pump 2</th>
                    <th class="text-center">Pump 3</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>Manufacturer</th>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p1Manufacturer"
                      />
                    </td>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p2Manufacturer"
                      />
                    </td>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p3Manufacturer"
                      />
                    </td>
                  </tr>
                  <tr>
                    <th>Type / Model</th>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p1Type"
                      />
                    </td>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p2Type"
                      />
                    </td>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p3Type"
                      />
                    </td>
                  </tr>
                  <tr>
                    <th>Rated Power (kW)</th>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        class="form-control form-control-sm"
                        name="p1Power"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        class="form-control form-control-sm"
                        name="p2Power"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        class="form-control form-control-sm"
                        name="p3Power"
                      />
                    </td>
                  </tr>
                  <tr>
                    <th>Rated Voltage / Current</th>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p1VoltCurr"
                      />
                    </td>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p2VoltCurr"
                      />
                    </td>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p3VoltCurr"
                      />
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- 4. MECHANICAL & ELECTRICAL EQUIPMENT CHECKS -->
            <div class="row">
              <div class="col-md-6">
                <div class="section-title">Mechanical Equipment Checks</div>
                <div class="table-responsive">
                  <table class="table table-bordered table-sm">
                    <thead class="table-light">
                      <tr>
                        <th>Check</th>
                        <th class="text-center">Y</th>
                        <th class="text-center">N</th>
                        <th class="text-center">N/A</th>
                        <th class="text-center">Pass</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Free from damage, wear &amp; missing parts</td>
                        <td class="text-center">
                          <input type="radio" name="mechDamage" value="Y" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="mechDamage" value="N" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="mechDamage" value="N/A" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" name="mechDamagePass" />
                        </td>
                      </tr>
                      <tr>
                        <td>Equipment securely mounted</td>
                        <td class="text-center">
                          <input type="radio" name="mechMounted" value="Y" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="mechMounted" value="N" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="mechMounted" value="N/A" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" name="mechMountedPass" />
                        </td>
                      </tr>
                      <tr>
                        <td>Free from blockages &amp; restrictions</td>
                        <td class="text-center">
                          <input type="radio" name="mechBlockages" value="Y" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="mechBlockages" value="N" />
                        </td>
                        <td class="text-center">
                          <input
                            type="radio"
                            name="mechBlockages"
                            value="N/A"
                          />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" name="mechBlockagesPass" />
                        </td>
                      </tr>
                      <tr>
                        <td>Free from air or fluid leaks / weeps</td>
                        <td class="text-center">
                          <input type="radio" name="mechLeaks" value="Y" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="mechLeaks" value="N" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="mechLeaks" value="N/A" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" name="mechLeaksPass" />
                        </td>
                      </tr>
                      <tr>
                        <td>Oil / coolant level correct</td>
                        <td class="text-center">
                          <input type="radio" name="mechOil" value="Y" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="mechOil" value="N" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="mechOil" value="N/A" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" name="mechOilPass" />
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="col-md-6">
                <div class="section-title">Electrical Equipment Checks</div>
                <div class="table-responsive">
                  <table class="table table-bordered table-sm">
                    <thead class="table-light">
                      <tr>
                        <th>Check</th>
                        <th class="text-center">Y</th>
                        <th class="text-center">N</th>
                        <th class="text-center">N/A</th>
                        <th class="text-center">Pass</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Free from damage &amp; missing parts</td>
                        <td class="text-center">
                          <input type="radio" name="elecDamage" value="Y" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="elecDamage" value="N" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="elecDamage" value="N/A" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" name="elecDamagePass" />
                        </td>
                      </tr>
                      <tr>
                        <td>Equipment securely mounted</td>
                        <td class="text-center">
                          <input type="radio" name="elecMounted" value="Y" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="elecMounted" value="N" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="elecMounted" value="N/A" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" name="elecMountedPass" />
                        </td>
                      </tr>
                      <tr>
                        <td>All connections correct &amp; secure</td>
                        <td class="text-center">
                          <input
                            type="radio"
                            name="elecConnections"
                            value="Y"
                          />
                        </td>
                        <td class="text-center">
                          <input
                            type="radio"
                            name="elecConnections"
                            value="N"
                          />
                        </td>
                        <td class="text-center">
                          <input
                            type="radio"
                            name="elecConnections"
                            value="N/A"
                          />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" name="elecConnectionsPass" />
                        </td>
                      </tr>
                      <tr>
                        <td>Cable entry points healthy (no ingress)</td>
                        <td class="text-center">
                          <input type="radio" name="elecCable" value="Y" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="elecCable" value="N" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="elecCable" value="N/A" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" name="elecCablePass" />
                        </td>
                      </tr>
                      <tr>
                        <td>Confirm correct rotation</td>
                        <td class="text-center">
                          <input type="radio" name="elecRotation" value="Y" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="elecRotation" value="N" />
                        </td>
                        <td class="text-center">
                          <input type="radio" name="elecRotation" value="N/A" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" name="elecRotationPass" />
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- 5. ELECTRICAL TEST RESULTS -->
            <div class="section-title">
              Electrical Test Results (Continuity, IR, Current, Voltage,
              Capacitance)
            </div>
            <div class="table-responsive mb-3">
              <table class="table table-bordered table-sm">
                <thead class="table-light">
                  <tr>
                    <th>Test</th>
                    <th class="text-center">Pump 1</th>
                    <th class="text-center">Pump 2</th>
                    <th class="text-center">Pump 3</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>Continuity U-V / U1-U2 (Ω)</th>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p1ContUV"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p2ContUV"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p3ContUV"
                        class="form-control form-control-sm"
                      />
                    </td>
                  </tr>
                  <tr>
                    <th>Continuity V-W / V1-W2 (Ω)</th>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p1ContVW"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p2ContVW"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p3ContVW"
                        class="form-control form-control-sm"
                      />
                    </td>
                  </tr>
                  <tr>
                    <th>Continuity W-U / W1-U2 (Ω)</th>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p1ContWU"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p2ContWU"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p3ContWU"
                        class="form-control form-control-sm"
                      />
                    </td>
                  </tr>

                  <tr>
                    <th>IR U-Earth (MΩ)</th>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p1IrUE"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p2IrUE"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p3IrUE"
                        class="form-control form-control-sm"
                      />
                    </td>
                  </tr>
                  <tr>
                    <th>IR V-Earth (MΩ)</th>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p1IrVE"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p2IrVE"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p3IrVE"
                        class="form-control form-control-sm"
                      />
                    </td>
                  </tr>
                  <tr>
                    <th>IR W-Earth (MΩ)</th>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p1IrWE"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p2IrWE"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p3IrWE"
                        class="form-control form-control-sm"
                      />
                    </td>
                  </tr>

                  <tr>
                    <th>Current (A, 3φ avg)</th>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p1Current"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p2Current"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p3Current"
                        class="form-control form-control-sm"
                      />
                    </td>
                  </tr>
                  <tr>
                    <th>Voltage (V, 3φ avg)</th>
                    <td>
                      <input
                        type="number"
                        step="0.1"
                        name="p1Voltage"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.1"
                        name="p2Voltage"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.1"
                        name="p3Voltage"
                        class="form-control form-control-sm"
                      />
                    </td>
                  </tr>
                  <tr>
                    <th>Capacitance (µF, 1φ only)</th>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p1Capacitance"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p2Capacitance"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        step="0.01"
                        name="p3Capacitance"
                        class="form-control form-control-sm"
                      />
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- 6. FAULT PROTECTION DEVICES & SETPOINT CONFIRMATION -->
            <div class="section-title">
              Fault Protection Devices &amp; Setpoint Confirmation
            </div>
            <div class="table-responsive mb-3">
              <table class="table table-bordered table-sm">
                <thead class="table-light">
                  <tr>
                    <th></th>
                    <th>Device Type</th>
                    <th>Rating (mA / A)</th>
                    <th>Other (specify)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>Pump 1</th>
                    <td>
                      <select
                        class="form-select form-select-sm"
                        name="p1ProtType"
                      >
                        <option value="">Select</option>
                        <option>MCB</option>
                        <option>RCD</option>
                        <option>O/L</option>
                        <option>Fuse</option>
                        <option>Other</option>
                      </select>
                    </td>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p1ProtRating"
                      />
                    </td>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p1ProtOther"
                      />
                    </td>
                  </tr>
                  <tr>
                    <th>Pump 2</th>
                    <td>
                      <select
                        class="form-select form-select-sm"
                        name="p2ProtType"
                      >
                        <option value="">Select</option>
                        <option>MCB</option>
                        <option>RCD</option>
                        <option>O/L</option>
                        <option>Fuse</option>
                        <option>Other</option>
                      </select>
                    </td>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p2ProtRating"
                      />
                    </td>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p2ProtOther"
                      />
                    </td>
                  </tr>
                  <tr>
                    <th>Pump 3</th>
                    <td>
                      <select
                        class="form-select form-select-sm"
                        name="p3ProtType"
                      >
                        <option value="">Select</option>
                        <option>MCB</option>
                        <option>RCD</option>
                        <option>O/L</option>
                        <option>Fuse</option>
                        <option>Other</option>
                      </select>
                    </td>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p3ProtRating"
                      />
                    </td>
                    <td>
                      <input
                        class="form-control form-control-sm"
                        name="p3ProtOther"
                      />
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- 7. SYSTEM CONTROL & SETPOINT CONFIRMATION -->
            <div class="section-title">
              System Control &amp; Setpoint Confirmation
            </div>
            <div class="row g-2 mb-3">
              <div class="col-md-6">
                <label class="form-label">Motor Starter Type</label>
                <select
                  class="form-select form-select-sm"
                  name="motorStarterType"
                >
                  <option value="">Select</option>
                  <option>DOL</option>
                  <option>Star/Delta</option>
                  <option>Soft Starter</option>
                  <option>VSD/Inverter</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Control Method</label>
                <select class="form-select form-select-sm" name="controlMethod">
                  <option value="">Select</option>
                  <option>Manual Start/Stop</option>
                  <option>Pressure</option>
                  <option>Flow</option>
                  <option>Level</option>
                  <option>Temperature</option>
                  <option>Time</option>
                  <option>Other</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Control Method (Other details)</label>
                <input
                  class="form-control form-control-sm"
                  name="controlMethodOther"
                  placeholder="If 'Other' selected, specify"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label">Control Device</label>
                <select class="form-select form-select-sm" name="controlDevice">
                  <option value="">Select</option>
                  <option>Pressure Switch</option>
                  <option>Float Switch</option>
                  <option>Conductive Probes</option>
                  <option>Ultrasonic</option>
                  <option>Other</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Duty Arrangement</label>
                <select
                  class="form-select form-select-sm"
                  name="dutyArrangement"
                >
                  <option value="">Select</option>
                  <option>FD</option>
                  <option>FD-A</option>
                  <option>FD-S</option>
                  <option>AD-A</option>
                  <option>AD-S</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Start Setpoints</label>
                <input
                  class="form-control form-control-sm"
                  name="startSetpoints"
                />
              </div>
              <div class="col-md-4">
                <label class="form-label">Stop Setpoints</label>
                <input
                  class="form-control form-control-sm"
                  name="stopSetpoints"
                />
              </div>
              <div class="col-md-4">
                <label class="form-label">Alarm Setpoints</label>
                <input
                  class="form-control form-control-sm"
                  name="alarmSetpoints"
                />
              </div>
            </div>

            <!-- 8. SUMMARY & SIGNATURES -->
            <div class="section-title">Summary &amp; Signatures</div>

            <div class="mb-2">
              <label class="form-label">Report Summary</label>
              <textarea
                class="form-control"
                name="reportSummary"
                rows="3"
              ></textarea>
            </div>

            <div class="mb-2">
              <label class="form-label d-block">Overall Result</label>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="overallResult"
                  id="resultPassed"
                  value="Passed"
                />
                <label class="form-check-label" for="resultPassed"
                  >Passed</label
                >
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="overallResult"
                  id="resultFailed"
                  value="Failed"
                />
                <label class="form-check-label" for="resultFailed"
                  >Failed</label
                >
              </div>
            </div>

            <div class="row g-2 mb-2">
              <div class="col-md-6">
                <label class="form-label">Arrival Time</label>
                <input
                  type="time"
                  class="form-control form-control-sm"
                  name="arrivalTime"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label">Departure Time</label>
                <input
                  type="time"
                  class="form-control form-control-sm"
                  name="departureTime"
                />
              </div>
            </div>

            <div class="row g-2 mb-2">
              <div class="col-md-4">
                <label class="form-label">FME Engineer (name)</label>
                <input
                  class="form-control form-control-sm"
                  name="engineerName"
                />
              </div>
              <div class="col-md-4">
                <label class="form-label">Engineer Signature (text)</label>
                <input
                  class="form-control form-control-sm"
                  name="engineerSign"
                />
              </div>
              <div class="col-md-4">
                <label class="form-label">Date</label>
                <input
                  type="date"
                  class="form-control form-control-sm"
                  id="engineerDate"
                  name="engineerDate"
                />
              </div>
            </div>

            <div class="row g-2 mb-2">
              <div class="col-md-4">
                <label class="form-label">Customer Representative (name)</label>
                <input
                  class="form-control form-control-sm"
                  name="customerRepName"
                />
              </div>
              <div class="col-md-4">
                <label class="form-label">Customer Signature (text)</label>
                <input
                  class="form-control form-control-sm"
                  name="customerRepSign"
                />
              </div>
              <div class="col-md-4">
                <label class="form-label">Date</label>
                <input
                  type="date"
                  class="form-control form-control-sm"
                  id="customerDate"
                  name="customerDate"
                />
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Additional Comments</label>
              <textarea
                class="form-control"
                name="additionalComments"
                rows="2"
              ></textarea>
            </div>

            <!-- Generate button -->
            <div class="d-grid mt-3 generate-btn-sticky">
              <button
                type="button"
                id="generatePdfBtn"
                class="btn btn-primary btn-lg"
              >
                Generate PDF Report
              </button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <!-- Bootstrap JS bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Helpers
      function val(name) {
        var el = document.querySelector('[name="' + name + '"]');
        return el && el.value ? el.value.trim() : "";
      }

      function radioVal(name) {
        var checked = document.querySelector(
          'input[name="' + name + '"]:checked'
        );
        return checked ? checked.value : "";
      }

      function checkedLabels(ids) {
        var out = [];
        ids.forEach(function (id) {
          var el = document.getElementById(id);
          if (el && el.checked) {
            var label = document.querySelector('label[for="' + id + '"]');
            out.push(label ? label.textContent.trim() : el.value);
          }
        });
        return out;
      }

      // Default dates to today
      (function initDates() {
        var today = new Date().toISOString().slice(0, 10);
        ["reportDate", "engineerDate", "customerDate"].forEach(function (id) {
          var el = document.getElementById(id);
          if (el && !el.value) el.value = today;
        });
      })();

      document
        .getElementById("generatePdfBtn")
        .addEventListener("click", function () {
          var form = document.getElementById("serviceForm");
          if (!form.checkValidity()) {
            form.classList.add("was-validated");
            alert(
              "Please complete the required fields (Customer & Date at minimum)."
            );
            return;
          }

          if (!window.jspdf || !window.jspdf.jsPDF) {
            alert("PDF library failed to load. Check your connection.");
            return;
          }

          var jsPDF = window.jspdf.jsPDF;
          var doc = new jsPDF({ unit: "mm", format: "a4" });
          var pageWidth = doc.internal.pageSize.getWidth();
          var margin = 12;

          // ---- HEADER ----
          var y = 14;
          doc.setFont("helvetica", "bold");
          doc.setFontSize(16);
          doc.text("FME Service Dept Report", pageWidth / 2, y, {
            align: "center",
          });
          doc.setFontSize(9);
          doc.text("", pageWidth - margin, y, { align: "right" });
          y += 4;
          doc.line(margin, y, pageWidth - margin, y);
          y += 4;

          // Convenience to start section titles
          function sectionTitle(title) {
            y = doc.lastAutoTable ? doc.lastAutoTable.finalY + 6 : y;
            doc.setFont("helvetica", "bold");
            doc.setFontSize(11);
            doc.text(title, margin, y);
            y += 2;
          }

          // ---- CUSTOMER / JOB INFO ----
          sectionTitle("Customer & Job Info");
          doc.autoTable({
            startY: y + 2,
            margin: { left: margin, right: margin },
            theme: "grid",
            styles: { fontSize: 9, cellPadding: 1.5 },
            headStyles: { fillColor: [230, 230, 230] },
            columnStyles: {
              0: { cellWidth: 32 },
              1: { cellWidth: pageWidth - 2 * margin - 32 },
            },
            head: [["Field", "Details"]],
            body: [
              ["Customer", val("customer")],
              ["Contact", val("contact")],
              ["Address", val("address")],
              ["Task No.", val("taskNo")],
              ["Tel No.", val("telNo")],
              ["Date", val("reportDate")],
            ],
          });

          // ---- GENERAL DETAILS ----
          var sector = checkedLabels([
            "sectorIndustrial",
            "sectorCommercial",
            "sectorDomestic",
            "sectorAgricultural",
          ]);
          var sectorOther = document.getElementById("sectorOther").value.trim();
          if (sectorOther) sector.push("Other: " + sectorOther);

          var hr = checkedLabels([
            "hrHeight",
            "hrConfined",
            "hrWater",
            "hrElectricity",
          ]);
          var hrOther = document.getElementById("hrOther").value.trim();
          if (hrOther) hr.push("Other: " + hrOther);

          var ppe = checkedLabels([
            "ppeLadder",
            "ppeScaffold",
            "ppeMewp",
            "ppeWinch",
            "ppeHarness",
            "ppeGasMonitor",
            "ppeEscapeSet",
          ]);
          var ppeOther = document.getElementById("ppeOther").value.trim();
          if (ppeOther) ppe.push("Other: " + ppeOther);

          var lift = checkedLabels(["liftTripod", "liftHoist", "liftCrane"]);
          var liftOther = document.getElementById("liftOther").value.trim();
          if (liftOther) lift.push("Other: " + liftOther);

          sectionTitle("General Details");
          doc.autoTable({
            startY: doc.lastAutoTable.finalY + 8,
            margin: { left: margin, right: margin },
            theme: "grid",
            styles: { fontSize: 9, cellPadding: 1.5, valign: "top" },
            headStyles: { fillColor: [230, 230, 230] },
            columnStyles: {
              0: { cellWidth: 40 },
              1: { cellWidth: pageWidth - 2 * margin - 40 },
            },
            head: [["Item", "Details"]],
            body: [
              ["Description of Works", val("descriptionOfWorks")],
              ["Sector", sector.join(", ")],
              ["High Risk Activities", hr.join(", ")],
              ["Specialist Equipment / PPE", ppe.join(", ")],
              ["Lifting Equipment Required", lift.join(", ")],
            ],
          });

          // ---- PUMP DETAILS ----
          sectionTitle("Equipment / Pump Details");
          doc.autoTable({
            startY: doc.lastAutoTable.finalY + 8,
            margin: { left: margin, right: margin },
            theme: "grid",
            styles: { fontSize: 9, cellPadding: 1.5 },
            headStyles: { fillColor: [230, 230, 230] },
            head: [["", "Pump 1", "Pump 2", "Pump 3"]],
            body: [
              [
                "Manufacturer",
                val("p1Manufacturer"),
                val("p2Manufacturer"),
                val("p3Manufacturer"),
              ],
              ["Type / Model", val("p1Type"), val("p2Type"), val("p3Type")],
              [
                "Rated Power (kW)",
                val("p1Power"),
                val("p2Power"),
                val("p3Power"),
              ],
              [
                "Rated Voltage / Current",
                val("p1VoltCurr"),
                val("p2VoltCurr"),
                val("p3VoltCurr"),
              ],
            ],
          });

          // ---- MECHANICAL CHECKS ----
          function checkRow(label, name, passName) {
            var status = radioVal(name);
            var passEl = document.querySelector('[name="' + passName + '"]');
            var pass = passEl && passEl.checked ? "Pass" : "";
            return [label, status, pass];
          }

          sectionTitle("Mechanical Equipment Checks");
          doc.autoTable({
            startY: doc.lastAutoTable.finalY + 8,
            margin: { left: margin, right: margin },
            theme: "grid",
            styles: { fontSize: 9, cellPadding: 1.5 },
            headStyles: { fillColor: [230, 230, 230] },
            columnStyles: {
              0: { cellWidth: pageWidth - 2 * margin - 35 },
              1: { cellWidth: 15 },
              2: { cellWidth: 20 },
            },
            head: [["Check", "Y/N/NA", "Pass"]],
            body: [
              checkRow(
                "Free from damage, wear & missing parts",
                "mechDamage",
                "mechDamagePass"
              ),
              checkRow(
                "Equipment securely mounted",
                "mechMounted",
                "mechMountedPass"
              ),
              checkRow(
                "Free from blockages & restrictions",
                "mechBlockages",
                "mechBlockagesPass"
              ),
              checkRow(
                "Free from air or fluid leaks / weeps",
                "mechLeaks",
                "mechLeaksPass"
              ),
              checkRow("Oil / coolant level correct", "mechOil", "mechOilPass"),
            ],
          });

          // ---- ELECTRICAL CHECKS ----
          sectionTitle("Electrical Equipment Checks");
          doc.autoTable({
            startY: doc.lastAutoTable.finalY + 8,
            margin: { left: margin, right: margin },
            theme: "grid",
            styles: { fontSize: 9, cellPadding: 1.5 },
            headStyles: { fillColor: [230, 230, 230] },
            columnStyles: {
              0: { cellWidth: pageWidth - 2 * margin - 35 },
              1: { cellWidth: 15 },
              2: { cellWidth: 20 },
            },
            head: [["Check", "Y/N/NA", "Pass"]],
            body: [
              checkRow(
                "Free from damage & missing parts",
                "elecDamage",
                "elecDamagePass"
              ),
              checkRow(
                "Equipment securely mounted",
                "elecMounted",
                "elecMountedPass"
              ),
              checkRow(
                "All connections correct & secure",
                "elecConnections",
                "elecConnectionsPass"
              ),
              checkRow(
                "Cable entry points healthy (no ingress)",
                "elecCable",
                "elecCablePass"
              ),
              checkRow(
                "Confirm correct rotation",
                "elecRotation",
                "elecRotationPass"
              ),
            ],
          });

          // ---- ELECTRICAL TEST RESULTS ----
          function testRow(label, base) {
            return [
              label,
              val("p1" + base),
              val("p2" + base),
              val("p3" + base),
            ];
          }

          // Electrical Test Results rows in PDF
          sectionTitle("Electrical Test Results");
          doc.autoTable({
            startY: doc.lastAutoTable.finalY + 8,
            margin: { left: margin, right: margin },
            theme: "grid",
            styles: { fontSize: 9, cellPadding: 1.5 },
            headStyles: { fillColor: [230, 230, 230] },
            head: [["Test", "Pump 1", "Pump 2", "Pump 3"]],
            body: [
              testRow("Continuity U-V / U1-U2 (Ohms)", "ContUV"),
              testRow("Continuity V-W / V1-W2 (Ohms)", "ContVW"),
              testRow("Continuity W-U / W1-U2 (Ohms)", "ContWU"),
              testRow("IR U-Earth (Mega Ohms)", "IrUE"),
              testRow("IR V-Earth (Mega Ohms)", "IrVE"),
              testRow("IR W-Earth (Mega Ohms)", "IrWE"),
              testRow("Current (A, 3 phase avg)", "Current"),
              testRow("Voltage (V, 3 phase avg)", "Voltage"),
              testRow("Capacitance (microfarads)", "Capacitance"),
            ],
          });

          // ---- FAULT PROTECTION ----
          sectionTitle("Fault Protection Devices & Setpoint Confirmation");
          doc.autoTable({
            startY: doc.lastAutoTable.finalY + 8,
            margin: { left: margin, right: margin },
            theme: "grid",
            styles: { fontSize: 9, cellPadding: 1.5 },
            headStyles: { fillColor: [230, 230, 230] },
            head: [["Pump", "Device Type", "Rating (mA/A)", "Other"]],
            body: [
              [
                "Pump 1",
                val("p1ProtType"),
                val("p1ProtRating"),
                val("p1ProtOther"),
              ],
              [
                "Pump 2",
                val("p2ProtType"),
                val("p2ProtRating"),
                val("p2ProtOther"),
              ],
              [
                "Pump 3",
                val("p3ProtType"),
                val("p3ProtRating"),
                val("p3ProtOther"),
              ],
            ],
          });

          // ---- SYSTEM CONTROL ----
          sectionTitle("System Control & Setpoint Confirmation");

          var controlMethodDisplay = val("controlMethod");
          if (controlMethodDisplay === "Other" && val("controlMethodOther")) {
            controlMethodDisplay += " (" + val("controlMethodOther") + ")";
          }

          doc.autoTable({
            startY: doc.lastAutoTable.finalY + 8,
            margin: { left: margin, right: margin },
            theme: "grid",
            styles: { fontSize: 9, cellPadding: 1.5 },
            headStyles: { fillColor: [230, 230, 230] },
            columnStyles: {
              0: { cellWidth: 55 },
              1: { cellWidth: pageWidth - 2 * margin - 55 },
            },
            head: [["Item", "Value"]],
            body: [
              ["Motor Starter Type", val("motorStarterType")],
              ["Control Method", controlMethodDisplay],
              ["Control Device", val("controlDevice")],
              ["Duty Arrangement", val("dutyArrangement")],
              ["Start Setpoints", val("startSetpoints")],
              ["Stop Setpoints", val("stopSetpoints")],
              ["Alarm Setpoints", val("alarmSetpoints")],
            ],
          });

          // ---- SUMMARY & SIGNATURES ----
          sectionTitle("Summary & Signatures");
          var overall = radioVal("overallResult") || "Not selected";
          doc.autoTable({
            startY: doc.lastAutoTable.finalY + 8,
            margin: { left: margin, right: margin },
            theme: "grid",
            styles: { fontSize: 9, cellPadding: 1.5, valign: "top" },
            headStyles: { fillColor: [230, 230, 230] },
            columnStyles: {
              0: { cellWidth: 45 },
              1: { cellWidth: pageWidth - 2 * margin - 45 },
            },
            head: [["Item", "Details"]],
            body: [
              ["Report Summary", val("reportSummary")],
              ["Overall Result", overall],
              ["Arrival Time", val("arrivalTime")],
              ["Departure Time", val("departureTime")],
              [
                "FME Engineer",
                "Name: " +
                  val("engineerName") +
                  " | Sign: " +
                  val("engineerSign") +
                  " | Date: " +
                  val("engineerDate"),
              ],
              [
                "Customer Representative",
                "Name: " +
                  val("customerRepName") +
                  " | Sign: " +
                  val("customerRepSign") +
                  " | Date: " +
                  val("customerDate"),
              ],
              ["Additional Comments", val("additionalComments")],
            ],
          });

          // Footer
          var footerY = doc.lastAutoTable.finalY + 6;
          if (footerY > doc.internal.pageSize.getHeight() - 10) {
            doc.addPage();
            footerY = doc.internal.pageSize.getHeight() - 10;
          }
          doc.setFont("helvetica", "normal");
          doc.setFontSize(8);
          doc.text("Generated by FME Service Dept Report App", margin, footerY);

          // File name
          var safeCustomer = (val("customer") || "customer").replace(
            /\s+/g,
            "_"
          );
          var safeDate = (val("reportDate") || "").replace(/-/g, "");
          var fileName =
            "FME_Service_Report_" + safeCustomer + "_" + safeDate + ".pdf";
          doc.save(fileName);
        });
    </script>
  </body>
</html>
